name: Zarf init with Injector

on:
  pull_request:

jobs:
  build-injector:
    # strategy:
    #   fail-fast: false
    #   matrix:
    #     os: ["ubuntu-24.04-arm", ]
    runs-on: "ubuntu-24.04"
    steps:
      - name: "Checkout Repo"
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

      - name: Install Zarf
        uses: zarf-dev/setup-zarf@10e539efed02f75ec39eb8823e22a5c795f492ae # v1.0.1

      - name: "Build injector"
        run: |
          make install-cross
          make injector
        
      - name: "Build Zarf package"
        run: |
          cd test
          zarf package create
      
      - name: "Setup K3d" 
        run: |
          curl -s https://raw.githubusercontent.com/k3d-io/k3d/main/install.sh | bash
          k3d cluster create
      
      - name: "Run zarf init"
        run: |
          cd test
          zarf init --confirm